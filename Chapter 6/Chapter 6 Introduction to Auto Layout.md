# Chapter 6: Introduction to Auto Layout

自动布局是一个api系统，它允许开发人员根据屏幕大小和/或各种设备处理来表达UI元素的尺寸和位置。

自动布局允许广泛的UI定制，从视图宽度的微小变化到美学上填充各种屏幕的空间，到在纵向和横向之间切换时从行到列完全重新排列UI布局。

本章是为读者需要iOS动画教程速成课程自动布局。你需要具备本章所教的技能，才能进入下一章，在那里你将学习自动布局中的动画。

如果您已经精通构建自动布局接口，您可以跳过第7章“动画约束”。

对于那些仍在阅读并渴望使用自动布局的读者，请首先想象一下，如果您愿意，一个没有自动布局的世界……

你负责为你的公司创建一个新的应用程序。

您的设计，建立与界面建设者，将看起来像这样的东西如下:



[图片]



视图的位置完全符合您的需要，然后您可以在Size检查器中检查它的框架。



[图片]



视图的位置和大小用点的绝对值表示。这看起来没问题，所以你启动iPhone 8模拟器，看看你漂亮的应用程序是如何运行的:



[图片]



发生了什么事？视图不再居中。问题是视图的位置用点表示;您在界面构建器中设计应用程序时考虑到了iPhone SE，但是由于iPhone 8的屏幕分辨率不同，您的视图看起来偏离了中心。

当你按Cmd +右箭头旋转模拟器时，情况变得更糟:



[图片]



接口生成器中的自动调整和重新定位系统为这类问题提供了部分解决方案。但是，如果您认真地想要创建可以使用多种设备大小和方向的动态和漂亮的用户界面，那么您需要开始使用自动布局。

## 自动布局救援
因为你不再生活在模糊地带，自动布局是一个现实，考虑相同的项目从以前，但这次使用自动布局:



[图片]



使用自动布局，很容易指出中心。文本视图的y属性应该等于中心。它的父视图的y值。这意味着文本视图将始终位于其父视图的中心——独立于应用程序运行的屏幕。

您还可以选择将文本视图的宽度设置为其父视图宽度的90%;这就在文本周围留下了5%的空白。

有了这一套简单的规则在手，自动布局愉快地重新排列元素在你的UI上好看的任何设备，在任何方向:



[图片]



“那么，这有什么大不了的呢?”你可能在想。嗯，这本身并没有什么问题，只是你需要换一种思维方式。

一旦你把你的应用程序放在自动布局的手中，你就不再设置视图的边界、框架或中心属性。如果你想尝试，UIKit会强制一个布局传递给你的UI使用自动布局，它会把所有东西设置回你的约束决定的位置和大小。

无法更改这些属性意味着您也无法使这些属性具有动画效果!因此，要移动视图或更改其形状，您将更改自动布局规则(或约束)，这些规则定义视图出现的位置及其大小。

但是在创建约束动画之前，首先需要学习如何创建约束，更重要的是，了解约束是如何工作的。

## 自动布局约束
在Xcode中打开本章的starter项目，然后构建并运行您的项目，看看它是什么样子的:



[图片]



没错——这个项目根本没有UI。您在本章的工作是构建一个带有自动布局的简单接口，并学习约束是如何工作的。

然而，该项目确实包括一些入门代码:

* ViewController。swift:这个类包含一些输出口，可以连接到你将在Interface Builder中创建的视图。此外，它还包含表视图委托和数据源方法，您将在向用户界面添加表视图后使用这些方法。

* HorizontalItemList。这是一个滚动视图子类，它显示了一个可滚动的图像列表。您将在下一章中使用这个类。

你的目标是建立一个非常简单的动态UI，它将在不同的设备和方向上有以下外观:



[图片]



### 添加顶部菜单

首先，将顶部菜单添加到接口文件。从视觉上看，该菜单将类似于导航栏。



[图片]



在下一章中，您将对其进行扩展和收缩，并为用户提供比普通的老式导航栏多得多的功能。

开放的主要。故事板，并拖动自定义视图到现有的视图控制器:



[图片]



使用属性检查器将视图的背景颜色更改为组表视图的背景颜色:



[图片]



将新视图的大小调整为或多或少类似于导航栏的大小;你现在不需要担心确切的尺寸。确保将视图切换到安全区域的顶部、左侧和右侧边缘:



[图片]



现在你可以看到视图了，你可以限制它始终停留在你在Interface Builder中模拟它的顶部区域。

> 注意:一定要把杆放在安全区域的顶部。这将确保它在所有设备类型上看起来都是正确的。

### 创建第一个约束
选择视图，然后单击Interface Builder右下角工具栏上的Pin按钮(也就是square TIE fighter按钮)——右边第二个按钮——:



[图片]



在弹出的弹出菜单中，取消对边距的约束，然后单击左侧、顶部和右侧指示器创建三个约束:



[图片]



单击Create 3 Constraints按钮将它们添加到视图并关闭弹出窗口。每个约束都是一个关系，表示为一个方程;您刚刚创建的顶部约束将表示为:

```swift
View.Top = 1 * Safe Area.Top + 0
```

新视图的顶部位置总是从安全区域的顶部开始为0 pt。

### 限制菜单高度
再次选择您的视图，然后再次单击Pin按钮以弹出约束。
这一次，您希望创建一个约束来将菜单视图的高度固定为常量。在弹出窗口中，您将看到在定位视图时设置的视图的高度。选中Height旁边的复选框，然后单击底部的Add 1 Constraint:



[图片]



现在你已经永远固定了菜单栏的高度。但是，如果您想让高度精确到44pt呢?让我们看看如何编辑已经创建的高度约束。

取消当前UI元素的选择，再次选择你的视图，然后切换到尺寸检查器，从右边的第二个标签在助理编辑器:



[图片]



在这里，你会看到所有的约束为选定的视图:



[图片]



你可能没有把高度固定到44pt，我们来修正一下。单击违规约束上的Edit按钮，并将其设置为44pt，如下所示:



[图片]



一旦你这样做，你会看到菜单相应地调整大小:



[图片]



使用视图作为:在故事板的底部，可以看到不同屏幕大小的布局被保留:



[图片]



它的工作原理!菜单视图总是固定在顶部和两侧，高度为44pt。

更好的是，你知道它是如何工作的。现在可以开始填充该菜单了。

### 添加菜单标题
将标签拖到菜单视图上，将其文本设置为Packing List，对齐到中心，字体大小设置为21.0。您的标签应该如下:



[图片]



现在需要将标签放在父视图的中间。选择标签，按住Ctrl键，用鼠标沿对角线方向拖拽到菜单栏，如下图所示:



[图片]



单击容器中的“水平居中”可在菜单中水平居中标签。然后，在按住Ctrl键的同时，再次拖动并垂直单击容器中的Center，使标签在菜单中垂直对齐。

这将创建约束，将标签的中心坐标固定到菜单的中心坐标:



[图片]



在Interface Builder中，事情看起来不是很好;除非你把标签精确地放在菜单视图的中央，否则你可能会看到如下内容:



[图片]



### 解决自动布局问题
在Interface Builder中进行设计时，拖拽视图可能会导致视图在Interface Builder中放置的位置与约束在运行时将它们放置的位置之间的差异(即视图手动定位在不反映应用约束的位置)。

在上面的图像中，标签恰好被精确地放置在菜单的垂直中心，所以Interface Builder用一个蓝色的向导指出这一点，指示垂直约束已经被满足。

然而，橙色的指南表示水平对齐约束“已被打破”。Interface Builder以实橙色显示视图的当前帧，并以虚线橙色显示约束期望的帧。



[图片]



您的标签将自动跳转到正确的位置和大小:



[图片]



标签上的两个新约束转化为以下方程:

```swift
Superview.CenterX = 1.0 * UILabel.CenterX + 0.0
```

```swift
Superview.CenterY = 1.0 * UILabel.CenterY + 0.0
```

接下来，您将在屏幕的右侧添加+按钮。

### 添加菜单按钮
将一个按钮拖到菜单视图上。设置标题为+，字体大小为27.0，对齐方式如下:



[图片]



单击Pin按钮并检查尾随空间约束。单击Create 1 Constraint将按钮固定在视图控制器的右边缘。



[图片]



到目前为止，您只创建了视图与其父视图之间的约束。但是你再也不用这样约束自己了——请原谅这个双关语!您还可以在视图层次结构的同一级别上创建视图之间的关系。

例如，将+按钮垂直对齐到标题标签是一个好主意。这样，即使您移动了标题标签，它们也始终会对齐。

### 用自动布局对齐视图
选择该按钮并按住Ctrl键，然后用鼠标从该按钮拖动到标签。当标签激活时释放鼠标按钮，你会看到一个弹出菜单，如下图所示:



[图片]



单击“垂直居中”可将按钮垂直对齐到标签。
确保常量为0(0)，新约束的第一项为+按钮，如下图所示:



[图片]



这很重要，因为您希望将按钮附加到标题上，而不是将按钮附加到标题上。如果你看到装箱单。将Y居中作为第一项，单击其旁边的下拉菜单，然后单击“反转第一项”和“反转第二项”来切换这两项。

现在再次选择按钮，如果启用了Update frames按钮，则单击它。这应该可以删除Interface Builder中的任何警告(如果有的话)。您几乎完成了用户界面的创建;唯一缺少的元素是table视图。

### 添加和约束表视图
拖动一个表视图，并将其放入空视图控制器空间:



[图片]



由于您已经非常熟练地使用了Interface Builder中的自动布局，您可能会轻松地完成设置表视图的步骤。

单击Pin按钮，取消对边距的约束，启用顶部、左侧、底部和右侧约束，并将它们全部设置为0;只是要注意在输入所有值之前不要过早地按回车键:



[图片]



点击Create 4 Constraints将这些Constraints添加到你的视图中，然后关闭弹出窗口:



[图片]



注意，通过Pin按钮弹出框创建的约束与表的最近邻居有关，而不一定是表的父视图。在左、右和底部约束的情况下，这是父视图——视图控制器的视图。

在上面的top约束的情况下，有一个邻近的视图更接近表的顶部—菜单。所以Interface Builder会自动获取top约束的视图。

您已经完成了应用程序的基本约束设置!现在，您已经很好地理解了自动布局是如何工作的，以及如何在Interface Builder中设置约束和视图之间的关系。多亏了这些新技能，在下一章中，您将为打包清单项目创建一些很酷的新动画。

## 完成用户界面
在继续之前，还有两件事需要处理:清理顶部的白条，并将现有的outlet连接到相应的UI元素。

白条是因为你使用的是安全区域布局指南。顶部的区域将由适用设备上的状态栏和/或缺口占用。您不希望将任何内容放在其中，但也不希望它以单独的颜色出现。选择白色区域，它将选择视图控制器的主视图。打开属性检查器并将背景颜色更改为组表视图背景，这与导航栏使用的颜色相同。白色区域会消失，你的“导航栏”会看起来更高。

> 注意:真正的导航控制器将导航栏拉伸到屏幕顶部，并使用安全区域空白来定位它们的内容，但是这对于本章来说有点高级!

用鼠标ctrl -拖动从视图控制器对象到表视图，然后从弹出菜单中选择tableView:



[图片]



然后ctrl -拖动从视图控制器到标题，并选择titleLabel:



[图片]



对+按钮做同样的操作，并选择buttonMenu:



[图片]



现在ctrl -拖动从按钮回到视图控制器，并选择actionToggleMenu。



[图片]



接下来，从表视图拖拽到视图控制器并选择dataSource:



[图片]



再次，ctrl -拖动从表视图到视图控制器，但这次选择委托:



[图片]



剩下的就是给表一个原型单元格。将表格视图单元格对象拖放到表格视图上，如下所示:



[图片]



然后打开属性检查器，输入标识符单元格:



[图片]



最后，构建并运行您的项目;ViewController.swift中的现有表视图代码将获取新连接的输出口，并用数据填充表:



[图片]



这款应用不仅看起来不错，而且由于自动布局，它的布局坚如磐石。让应用程序在不同的模拟器- iPhone(缺口和非缺口)和iPad -和改变方向，以检查它自己!



## 要点
* 使用自动布局，你不用绝对值来设置视图的位置和大小，而是用相对于屏幕大小或视图层次结构中的其他视图来表示它们。
* 按住Ctrl键在视图之间拖动，然后从弹出菜单中选择约束类型，从而在视图之间创建新的约束。
* 一旦一个视图设置了它的约束(完全确定它的位置和大小)，它将自动布局在任何屏幕大小上。

## 挑战
这次的挑战很简单:直接进入下一章!到目前为止，您已经对自动布局有了一些详细的了解，这是您在下一章(将讨论动画和自动布局)中将要进行的工作的一个重要先决条件。
下一章见!